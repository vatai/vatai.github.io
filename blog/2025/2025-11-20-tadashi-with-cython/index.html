<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>This post is basically me <a href="https://blog.codinghorror.com/rubber-duck-problem-solving/" rel="external nofollow noopener" target="_blank">rubber-ducking</a> how I should refactor <a href="/projects/tadashi">Tadashi</a> <a class="citation" href="#vatai2025tadashi">(Vatai et al., 2025)</a> to include LLVM/Polly backend (which would enable fortran support). I’ll try to list the requirements focusing on the Python-C/C++ interface.</p> <p>We need a <em>Python</em> interface to specify the C input program and the backend, and it should return a <em>Python</em> object which we’ll use for:</p> <ul> <li>querying transformations</li> <li>executing transformations</li> <li>generating transformed code</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span> <span class="o">=</span> <span class="nc">App</span><span class="p">(</span><span class="sh">"</span><span class="s">source.c</span><span class="sh">"</span><span class="p">,</span> <span class="n">backendPET</span><span class="p">)</span>
<span class="c1"># list[scop] = backendPET("sources.")
# pet: run transform fn (in C)
# llvm: run clang (both) and collect schedule (in C)
</span></code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">node</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="n">scops</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">schedule_tree</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="c1"># locate node (in C, in scop)
</span>
<span class="n">legal</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="nf">transform</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="c1"># transform, (in C, in scop)
</span>
<span class="n">tapp</span> <span class="o">=</span> <span class="n">app</span><span class="p">.</span><span class="nf">gencode</span><span class="p">()</span>
<span class="c1"># pet: run again transofm(list[pet_scop*])
# llvm: write scop-&gt;json and run clang
</span>
<span class="n">tapp</span><span class="p">.</span><span class="nf">measure</span><span class="p">()</span>
<span class="c1"># 100% in pyhon
</span></code></pre></div></div> <pre><code class="language-mermaid">sequenceDiagram
  participant M as ml_model.py
  participant A as app.py
  participant T as translator.py
  M-&gt;&gt;A: ("source.c", translator{PET/LLVM})
  A-&gt;&gt;T: "source.c"
  T-&gt;&gt;A: `list[Scop]`
</code></pre> <p> </p> <p> </p> <p> </p> <p> </p> </body></html>